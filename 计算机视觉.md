# 总述

像素——特征——图片——视频——摄像机——多视图几何



# （一）像素特征级

## 1.卷积核

高斯卷积核（平滑）

核的大小 = 6*σ+1（非常重要，σ越大，核越大，卷积计算复杂度越高）



## 2.边缘提取

（1）差分滤波核（Prewitt，Sobel，Roberts）

（2）高斯一阶差分，平滑去噪提取边缘，检测***极值点***即边缘

​		高斯二阶差分（拉普拉斯—高斯滤波核），检测***过零点***即边缘

（3）cannny算法

​		高斯去噪——求梯度大小方向（得到粗边缘）——非极大值抑制（得到单像素边缘）——双阈值处理（得到最终实际边缘）



## 3.拟合

（1）问题：噪声，外点（多线），遮挡

（2）①全内点——最小二乘（低级和Total least squares）

求解：矩阵特征值法求最优解；矩阵求导法。

***备注***：低级，不具备旋转不变性，Total解决该问题；Total的数学模型是：带高斯随机外点的最大似然估计。

②有外点——RANSAC（很多外点），鲁棒最小二乘（限制外点贡献，如log替代线性（外点比较少））

求解：RANSAC：随机选定点确定模型——其他点投票评估模型——迭代直至寻到高投票阈值

参数：选定点个数s，投票阈值t，迭代次数N，外点率e，可信度p

标准：（1-（1-e）^s）^N = 1-p

***备注***：设定N为无穷，迭代之后不断减小N，最后达到满足公式要求即可

③多线——RANSAC, Hough（线，圆）

线：二维参数空间（ρ，theta——有限值）

圆：三维参数空间（r，x，y）

求解：对图片上每个点进行遍历，先对r/ρ遍历（有限范围），再根据梯度方向确定theta遍历范围，并对theta遍历，进行投票即可。需要搭配nonmax_suppress

***备注***：广义Hough（检测模版）



## 4.harris角点

（1）特征点：紧凑高效，特异性高，重复性好，定位

（2）角点：窗口梯度有***两个***以上主导方向（x，y）

（3）研究重点：***二阶矩矩阵***M（对称阵）

思想：可对角化，特征值代表方向梯度大小，因此我们寻找的角点就是<u>两个***特征值***λ1和λ2都比较大</u>的点。（结合nonmax__suppress）

求解：遍历像素求高斯导——得到二阶矩矩阵M（用高斯窗）——计算角点响应R并阈值处理——非极大值抑制——得到角点

***备注***：光度不变性，位置旋转平移协变性，尺度没有不变和协变性（SIFT帮助解决这个问题）



## 5.SIFT特征（blob斑点检测）

（1）拉普拉斯响应具备尺度和旋转不变性

（2）原理：拉普拉斯高斯卷积核处理（斑点r=σ½时，出现极大值点，用不同段位的σ处理，进而得到斑点位置和大小半径r）

问题：Laplace—Gaussian卷积运算复杂度随σ升高而升高

***解决***：DOG(高斯差分金字塔)降低运算复杂度

①高斯差分DOG替代L—G卷积核

②大σ高斯卷积核<u>分解</u>为小σ高斯卷积核<u>串联卷积</u>

③对σ高斯卷积后图像的进行欠采样，得到小图样，相对来说就是2倍σ卷积，使得最终DOG翻倍，一举两得。

（2）***新的问题***：仿射变换不具备协变性

①***尺度***协变性解决：利用二阶矩矩阵M，圆的某一方向半径大小和该方向梯度大小成***反比***；如果该方向梯度小，则不断缩小圆的半径，形成椭圆，直至两垂直方向梯度大小相等。我们就将圆形的blob变换成了椭圆形的blob。

②***旋转***协变性解决：分割图像的一个batch（特征点blob），求解每一小格梯度方向和大小，构建直方图，选择梯度最大的方向作为batch的方向，进而通过旋转使其具有旋转协变性。



## 6.纹理

（1）作用：恢复结构，***分割聚类***（分类），合成

（2）纹理表示：图片分成小batch，用高斯一阶导卷积核进行卷积，作图（K-means聚类，对batch分类）

（3）用***n类型***卷积核组进行卷积，得到不同的纹理特征图。不同的卷积核组代表不同的特征。

处理手段①加权平均后，即可得到该特征在图像中的比重。（类似CNN的全局平均池化，每个通道输出一个平均值，用这个代替全连接层）

②将图像每个像素点的特征卷积结果展开为***n通道图像***。（类似于CNN中的卷积层，最后来个全连接层liner）



# （二）图片级

## 1.分割segmentation

（1）目的：将相近似的像素/特征点划分为一类，以提高效率方便进一步处理

（2）聚类算法

①k-means（需要初始化k值）

②mean—shift（重心迭代偏移，只有一个参数半径）

③图割

（3）表示特征

①RGBxy表示

②纹理特征卷积向量

## 2.分类classification

(1)困难：视角，光照，尺度，变形，遮挡，干扰

(2)表达——学习——识别

(3)词袋模型（用于表示图像）

思路：特征提取——***聚类***——形成词袋——用词袋向量表示图像——进行后续处理（如相似性度量，用向量余弦夹角判断相似度，越小越相似）

核心：用词袋向量表示图像（频率直方图向量，向量维度即词袋库包含单词数量）

难度：划分提取特征词袋

引申创新方法：TF-IDF (term frequency词频因子——inverse document frequency逆文档频率因子)

## 3.检测detection

（1）滑动窗口

（2）boosting（许多弱分类器***加权组合***为强分类器）

许多简单分类器（输出只有1/0）判断投票——投票超过一半就输出1，否则输出0——反向修正权值





# （三）多视图几何

## 1.摄像机模型

- 透视投影摄像机（11F）

- 弱透视投影摄像机（8F）

  

## 2.摄像机标定（单视图）

- 透视标定

  11F需要6对点，SVD得到投影矩阵，进而通过公式法得到内参外参矩阵（KRT）

- 单视图重构

  

## 3.多视图几何

- 摄像机几何（求内外参）

- 2D对应点关系（极几何）

  - 本质矩阵（5F）

    - 弱透视
    - 对应关系：p'Ep = 0
    - 本质矩阵分解：***E = T × R***

  - 基础矩阵（7F）

    - 透视

    - 对应关系p'Fp = 0

    - 八点法估计

      问题：八对点数值差异过大，有数值计算问题

    - 归一化八点法

      要求：对图像施加 T 变换(平移缩放，改变原点位置)，使得原点 = 八点重心，八点到原点均方根距离 = 2½

      结果： F = T' Fq T

  - 单应矩阵

    - 补充基础矩阵：①对应点在同一个平面上②2D图像之间只有旋转而无平移
    - 区别：EF建立***点与极线***关系，H建立***点与点***关系
    - 四点法

- 场景几何（求3D点）

  - 问题：已知2D图像对应点（***特征点匹配***），已知透视矩阵KRT。求解3D点坐标

  - 三角化

    - 线性解法（超定，SVD分解）

    - 非线性（牛顿法、L-M法）

      即寻找P最小化   d（p，MP）+d（p‘，M’P）

- 平行视图几何（特例）

  - 特点：极线平行基线，pv=pv‘

  - 视差公式

    pu-pu‘ = B f / z

    视差与深度z成反比

  - 归一化相关匹配求对应点（窗口移动法）

  - 图像校正（获得平行视图）

    - 8 对匹配点求基础矩阵F
    - 利用F 求 极点 e 和 e'
    - 透视变换H 将e’投影到无穷远（f，0，0）
    - 求出最优的H矩阵即可



## 4.SFM

（1）欧式结构恢复（已知K，求解外参和3D点）

- ①归一化八点法求基础矩阵F

  特征提取：获取sift特征点，尺寸旋转归一化，特征点区域分块（如4*4）并计算八方向梯度，得到**128维数据**描述该特征点。

  特征匹配：对一个特征点，遍历其他图像所有特征点，判断是否符合距离阈值，这样就找到了***极几何中的对应点***

  RANSAC估计基础矩阵F：随机均匀采样八对点对，获得分***评分最高***的F。（这个评分后面可以用来作为构建连通图Edge的权重）

  ②利用F和摄像机内参K求解本质矩阵E

  ③本质矩阵E分解求得R和T（外参矩阵）

  - SVD分解 E
  - 代入公式得到四组 ***R*** 和 ***T***
  - 重建3D点找出正确解

  ④三角化求解世界空间中***三维点坐标***

- 恢复歧义

  恢复的结构和真实场景之间相差一个***相似



（2）增量法求解SFM（从2视图逐渐 **增量到 **n视图）

预处理特点：需要***同时***估计基础矩阵F和单应矩阵H（四点法求H，防止特征点在一个平面上），并选择评分高的矩阵。

思路：

①***预处理，***完成n张图像上的所有特征点的提取和匹配

②2视图构建初始点云

获取n视图的连通图，以及n张图像***共有***的特征点t（我们只重建这些点，其他点舍去），只有特征点配对数达到***阈值***的图像之间才有Edge；

选取一条Edge（即两张图像），利用n张图像共有的特征点（要求要满足选中的2张图像点与点之间角度关系（5°-60°）），进行2视图重构

得到初始重建结果（***初始重建结果***：2张图像的外参矩阵，共有特征点t的三维点世界坐标（满足这两张图像角度关系的共有特征点））。

***删除***已经完成重构的Edge（即已经求得***外参矩阵***的Edge）。

③增加视图并完成重建

while（如果还有边）

​	选择一条包含最多的 已重建3D点 的边进行重建

​	PnP估计图像***外参***（已知已重建3D点，以及对应的图像像素坐标，还有摄像机内参矩阵）

​	***备注：***这里获取到的图像外参，是相对于第一张图像外参矩阵的相对值，我们习惯上设第一张图像	坐标系就是世界坐标系。

​	三角化新的满足角度关系的共有特征点t

​	删除重建过的Edge

​	使用bundle adjustment进行优化，减小累积误差。

④over



（3）词袋模型（图像用词袋向量表示）

